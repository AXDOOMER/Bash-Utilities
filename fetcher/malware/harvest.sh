#!/bin/bash
# Copyright (c) Alexandre-Xavier Lamoureux 2017-2018
# Automatically get the malware URLs from VX Vault and download them

list="/tmp/malware-list.txt"
savefolder="malware/"
url="http://vxvault.net/URL_List.php"

# User agents:
useragent="Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
#useragent="Mozilla/5.0 (Linux; Android 7.0; PLUS Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.98 Mobile Safari/537.36"
#useragent="Mozilla/5.0 (Windows Phone 8.1; ARM; Trident/7.0; Touch; WebView/2.0; rv:11.0; IEMobile/11.0; NOKIA; Lumia 525) like Gecko"
#useragent="Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)"
#useragent="Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13"

# Test for programs to see if they are installed

if ! command -v wget >/dev/null 2>&1; then
	echo "Wget cannot be found."
	exit 1
fi
if ! command -v torsocks >/dev/null 2>&1; then
	echo "TorSocks cannot be found."
	exit 1
fi
if ! command -v dos2unix >/dev/null 2>&1; then
	echo "DOS2Unix cannot be found."
	exit 1
fi

# The actual program

wget $url -O $list

dos2unix $list

while read in; do
	if [[ "$in" == http* ]]; then
		torsocks wget --tries=3 --no-clobber --directory-prefix="$savefolder" --user-agent="$useragent" "$in";
	fi
done < $list

echo "Done!"
